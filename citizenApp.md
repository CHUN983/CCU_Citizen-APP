# 市民參與城市規劃行動應用系統需求文件

## 一、Introduction

### （一）Purpose of this Document
本文件旨在描述「市民參與城市規劃」行動應用（以下稱本系統）的需求分析與設計基礎，提供開發、測試、部署與驗收所需之規範與依據。
文件內容包含功能性需求、非功能性需求、系統架構概要、資料庫設計要點、開發時程 (Project Schedule)、驗證與確認 (V&V) 計畫及風險管理。
期望藉由本文件，使專案團隊、相關利害關係人與未來維運者對系統需求與驗收準則達成共識。

### （二）Purpose of the Product－產品定位
本系統為一款支援多模態（文字、圖片、影片）意見提交與管理的行動應用，目標使用者包括：市民、各局處行政人員、管理者與潛在研究或監督單位。
系統核心價值：**可追蹤、透明、互動**，提供市民表達意見、政府彙整回應之雙向溝通平台，提升公共治理效率與參與感。

### （三）Product Scope
**第一階段（MVP）包含：**
- **核心功能：** 用戶註冊/登入、意見發表（含多媒體）、意見瀏覽、留言/投票/收藏、通知、管理端審核（approve/reject/merge）。
- **支援平台：** Android / iOS 前端，後端 RESTful API，MySQL 資料庫，本機或校園伺服器部署。
- **排除項目（第一階段）：** 深度自動語意合併（NLP 自動合併為下階段擴充）、完整資料分析儀表板（後期擴充）。

---

## 二、System Requirements

### （一）Functional Requirement
根據產品目標與使用者需求，系統分為四大子系統：意見系統、瀏覽系統、用戶系統、審核系統。

#### 1. 意見系統
- 分類功能（分類/處室、狀態、關鍵字、地區、時間，多標籤支援樹結構兩層）  
- 多模態資料輸入（文字、圖片、影片）  
- 歷史紀錄與意見編號  
- 草稿功能（離線儲存，網路恢復後上傳）  

#### 2. 瀏覽系統
- 意見瀏覽與回饋（留言、按讚、收藏）  
- 通知功能（非即時提醒回覆或審核結果）  
- 收藏與篩選功能  
- 最新消息與引用功能（提高互動性）  
- 標籤顯示（已解決/未解決/未採納）  

#### 3. 用戶系統
- 身分認證與角色分級（市民、行政人員、管理員）  
- 訪客瀏覽功能  

#### 4. 審核系統
- 合併/關聯相似主題  
- 通過/拒絕審核  
- 修改標籤與刪除評論  
- 自動化分類

### （二）Non-Functional Requirement
- **I/O 裝置：** Android/iOS 為主要平台。  
- **效能：** 須避免行動端過度 Loading。  
- **記憶體管理：** 對大型影音上傳需優化後端。  

### （三）Interface
- **個人化設定：** 通知與篩選條件調整。  
- **功能模塊設計：** 明確分區（意見瀏覽、提交）。  
- **流程圖：** 
┌──────────────────────────────────────────────────────┐
│                      使用者端（前端）                 │
│  發表意見、上傳圖片/語音/影片                         │
└──────────────┬──────────────────────────────────────┘
               │  POST /opinions
               ▼
┌──────────────────────────────────────────────────────┐
│                   API Gateway                        │
│ 驗證 JWT / 權限檢查 / 呼叫對應 UseCase                │
└──────────────┬──────────────────────────────────────┘
               │
               ▼
┌──────────────────────────────────────────────────────┐
│                  意見系統（Opinion System）           │
│ 建立意見 → 儲存至 DB → 發送 Domain Event（EventBus） │
└──────────────┬──────────────────────────────────────┘
               │
               ▼
┌──────────────────────────────────────────────────────┐
│                  自動化分類服務（AI Service）         │
│ 1. 資料對齊（Multimodal Alignment）                   │
│    ├─ 語音 → Whisper → 文字                          │
│    ├─ 圖片 → CNN / CLIP → 標籤文字                  │
│    └─ 影片 → 音訊 + 幀擷取 → 文字描述               │
│ 2. NLP 分析與分類                                    │
│    ├─ 情緒 / 惡意偵測（Sentiment / Toxic Model）     │
│    ├─ 自動標籤分類（BERT / RoBERTa）                 │
│    └─ 低信心樣本 → 標記「待人工審核」                │
└──────────────┬──────────────────────────────────────┘
               │
               ▼
┌──────────────────────────────────────────────────────┐
│                 審核系統（Moderation System）          │
│ 管理員後台：合併 / 拒絕 / 修改標籤 / 刪除評論          │
│ 可參考 AI 建議分類結果並人工修正                     │
└──────────────┬──────────────────────────────────────┘
               │
               ▼
┌──────────────────────────────────────────────────────┐
│               通知系統（Notification Service）        │
│ 透過 WebSocket / Push 通知發表者與追蹤者              │
│ 例如：「您的意見已通過審核」或「被合併至主題X」       │
└──────────────┬──────────────────────────────────────┘
               │
               ▼
┌──────────────────────────────────────────────────────┐
│                     MySQL / Cache                    │
│ 儲存意見、分類結果、通知狀態與模型信心分數             │
└──────────────────────────────────────────────────────┘


## 三、Project Schedule

### （二）里程碑
| 里程碑 | 日期 | 說明 |
|--------|------|------|
| M1 | 114/10/14 | 需求文件完成 |
| M2 | 114/11/10 | 設計規格定稿 |
| M3 | 114/11/30 | 核心功能可展示 |
| M4 | 114/12/08 | 整合測試完成 |
| M5 | 114/12/16 | 驗收上線 |

---

### （二）Design Plan
- 系統架構：前端 (Vue/React) ↔ RESTful API ↔ MySQL。
- 各子系統間共用資料與 API。
- 通知系統依賴其他子系統事件。

### （三）API 範例

#### 認證/用戶
```
POST /auth/login
GET /me
PUT /me/subscriptions
```

#### 意見
```
GET /opinions
GET /opinions/{id}
POST /opinions
PUT /opinions/{id}
POST /opinions/{id}/comments
POST /opinions/{id}/vote
POST /opinions/{id}/collect
DELETE /opinions/{id}/collect
GET /opinions/{id}/history
```

#### 通知
```
GET /notifications
POST /notifications/read
```

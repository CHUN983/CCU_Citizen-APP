# 市民參與城市規劃 APP - 測試計劃 (Test Plan)

**文件版本**: 1.0
**建立日期**: 2025-10-24
**專案名稱**: 市民參與城市規劃 APP
**測試負責人**: V&V Team

---

## 📋 目錄
1. [測試目標](#1-測試目標)
2. [測試範圍](#2-測試範圍)
3. [測試策略](#3-測試策略)
4. [測試環境](#4-測試環境)
5. [測試資源](#5-測試資源)
6. [測試排程](#6-測試排程)
7. [風險評估](#7-風險評估)
8. [驗收標準](#8-驗收標準)

---

## 1. 測試目標

### 1.1 主要目標
- **Verification（驗證）**: 確保系統按照規格正確實作
- **Validation（確認）**: 確保系統符合用戶需求和期望
- **品質保證**: 確保產品達到可交付的品質標準
- **風險降低**: 及早發現並修復缺陷

### 1.2 具體目標
- ✅ 達到 **80%+ 程式碼覆蓋率**
- ✅ 所有核心功能通過測試
- ✅ API 回應時間 < 500ms (95th percentile)
- ✅ 零 Critical/High 優先級缺陷
- ✅ 系統可支援 100+ 併發用戶

---

## 2. 測試範圍

### 2.1 包含在測試範圍內

#### 後端 API (FastAPI)
- ✅ **認證系統** (3 endpoints)
  - 用戶註冊、登入、取得當前用戶資訊
- ✅ **意見系統** (9 endpoints)
  - CRUD、留言、投票、收藏
- ✅ **媒體系統** (5 endpoints)
  - 上傳、下載、刪除、縮圖生成
- ✅ **通知系統** (2 endpoints)
- ✅ **管理系統** (5 endpoints)
  - 審核、合併、分類管理

#### 前端系統 (Vue 3 Admin Dashboard)
- ✅ **登入功能**
- ✅ **儀表板**
- ✅ **意見管理** (列表、詳情、審核)

#### 資料庫
- ✅ **Schema 正確性**
- ✅ **資料完整性約束**
- ✅ **索引效能**

#### 整合測試
- ✅ **前後端整合**
- ✅ **資料庫整合**
- ✅ **第三方服務整合**

### 2.2 不包含在測試範圍內
- ❌ Android App (尚未實作)
- ❌ iOS App (尚未規劃)
- ❌ AI 自動分類功能 (尚未實作)
- ❌ 第三方 OAuth 登入 (非 MVP 功能)

---

## 3. 測試策略

### 3.1 測試金字塔

```
           ┌─────────────┐
          ╱ E2E Tests    ╲     10% - 系統測試
         ╱    (10%)      ╲
        ├─────────────────┤
       ╱  Integration     ╲    30% - 整合測試
      ╱   Tests (30%)     ╱
     ├───────────────────┤
    ╱   Unit Tests       ╱      60% - 單元測試
   ╱      (60%)         ╱
  └─────────────────────┘
```

### 3.2 測試類型與工具

| 測試類型 | 範圍 | 工具 | 執行頻率 |
|---------|------|------|---------|
| **單元測試** | 個別函數、類別 | pytest, Jest | 每次 commit |
| **整合測試** | API endpoints, DB | pytest + TestClient | 每次 push |
| **系統測試** | 完整用戶流程 | Playwright, Postman | 每日/每次發布 |
| **效能測試** | 負載、壓力測試 | Locust, k6 | 每週/發布前 |
| **安全測試** | 漏洞掃描 | Bandit, OWASP ZAP | 發布前 |

### 3.3 測試層級說明

#### Level 1: 單元測試 (Unit Tests)
**目標**: 測試最小可測試單元的正確性

**Python 後端**:
```python
# 測試範例
tests/unit/
├── test_security.py        # 測試密碼 hash、JWT
├── test_models.py          # 測試 Pydantic models
├── test_services.py        # 測試 business logic
└── test_utils.py           # 測試工具函數
```

**Vue 前端**:
```javascript
tests/unit/
├── components/            # 測試 Vue 組件
├── store/                # 測試 Pinia store
└── utils/                # 測試工具函數
```

**覆蓋率目標**: 80%+

#### Level 2: 整合測試 (Integration Tests)
**目標**: 測試模組間的互動

```python
tests/integration/
├── test_auth_api.py        # 測試認證 API 流程
├── test_opinion_api.py     # 測試意見 API 流程
├── test_media_api.py       # 測試媒體上傳流程
├── test_admin_api.py       # 測試管理功能流程
└── test_database.py        # 測試資料庫操作
```

**測試內容**:
- API endpoint 正確性
- 資料庫 CRUD 操作
- 認證與權限控制
- 錯誤處理

#### Level 3: 系統測試 (System Tests)
**目標**: 測試完整的端到端流程

```python
tests/system/
├── test_user_journey.py    # 完整用戶旅程
├── test_admin_workflow.py  # 管理員工作流程
└── test_opinion_lifecycle.py # 意見生命週期
```

**測試場景**:
1. 用戶註冊 → 登入 → 發表意見 → 上傳圖片
2. 管理員登入 → 審核意見 → 核准/拒絕
3. 用戶查看意見 → 留言 → 投票 → 收藏

#### Level 4: 效能測試 (Performance Tests)
**目標**: 確保系統在負載下的表現

```python
tests/performance/
├── load_test.py           # 負載測試
├── stress_test.py         # 壓力測試
└── spike_test.py          # 尖峰測試
```

**測試指標**:
- **回應時間**: P95 < 500ms
- **吞吐量**: 100+ req/sec
- **併發用戶**: 100+ 同時在線
- **錯誤率**: < 0.1%

---

## 4. 測試環境

### 4.1 測試環境配置

| 環境 | 用途 | 配置 |
|-----|------|------|
| **開發環境** | 開發人員本地測試 | Local (Docker) |
| **CI 環境** | 自動化測試 | GitHub Actions |
| **測試環境** | 整合測試 | Docker Compose |
| **預生產環境** | 發布前驗證 | AWS/GCP (Optional) |

### 4.2 測試資料

#### 測試資料庫
- 使用 Docker MySQL 容器
- 每次測試前重置資料庫
- 使用 fixtures 預載測試資料

#### 測試帳號
```python
# 測試用戶
test_users = {
    "citizen": {"username": "test_user", "password": "test123"},
    "admin": {"username": "admin", "password": "admin123"},
    "government": {"username": "gov_staff", "password": "gov123"}
}
```

### 4.3 測試工具版本

```yaml
# Python 測試工具
pytest: ^8.0.0
pytest-cov: ^4.1.0
pytest-asyncio: ^0.23.0
httpx: ^0.27.0        # API 測試
faker: ^24.0.0        # 測試資料生成

# 效能測試
locust: ^2.20.0

# 前端測試
vitest: ^1.0.0
@vue/test-utils: ^2.4.0
playwright: ^1.40.0
```

---

## 5. 測試資源

### 5.1 人力資源

| 角色 | 負責人 | 職責 |
|-----|-------|------|
| **測試負責人** | Team Leader | 整體測試規劃、風險管理 |
| **後端測試工程師** | Backend Dev | 單元測試、整合測試 |
| **前端測試工程師** | Frontend Dev | UI 測試、E2E 測試 |
| **自動化工程師** | DevOps | CI/CD、自動化測試 |
| **效能測試工程師** | Senior Dev | 負載測試、效能優化 |

### 5.2 硬體資源

- **開發機器**: 本地電腦
- **CI 伺服器**: GitHub Actions (免費方案)
- **測試資料庫**: Docker MySQL 8.0
- **效能測試**: 本地 + Cloud (optional)

---

## 6. 測試排程

### 6.1 測試時程表 (1 週)

#### Week 1: 測試框架建立與單元測試
```
Day 1-2: 測試環境設置
├── 安裝測試框架 (pytest, vitest)
├── 配置 CI/CD 測試流程
└── 建立測試資料庫與 fixtures

Day 3-4: 單元測試開發
├── Python 後端單元測試 (50+ tests)
├── Vue 前端單元測試 (30+ tests)
└── 目標: 80% 覆蓋率

Day 5: 整合測試開發
├── API 整合測試 (24+ endpoints)
├── 資料庫整合測試
└── 認證流程測試

Day 6: 系統測試與效能測試
├── E2E 測試場景 (5+ scenarios)
├── 效能測試腳本
└── 負載測試執行

Day 7: 測試報告與文件
├── 測試執行與缺陷記錄
├── 測試報告生成
└── 追蹤矩陣建立
```

### 6.2 測試執行頻率

| 測試類型 | 執行時機 | 執行者 |
|---------|---------|--------|
| 單元測試 | 每次 commit | 開發人員 |
| 整合測試 | 每次 push | CI/CD |
| 系統測試 | 每日/發布前 | QA Team |
| 效能測試 | 每週/發布前 | DevOps |
| 迴歸測試 | 每次變更後 | CI/CD |

---

## 7. 風險評估

### 7.1 測試風險

| 風險 | 機率 | 影響 | 緩解措施 |
|-----|------|------|---------|
| **測試時間不足** | 中 | 高 | 優先測試核心功能，使用自動化 |
| **測試資料不完整** | 低 | 中 | 使用 Faker 生成大量測試資料 |
| **環境不穩定** | 中 | 中 | 使用 Docker 確保環境一致性 |
| **缺陷修復時間長** | 中 | 高 | 及早測試，持續整合 |
| **效能問題難以重現** | 高 | 中 | 使用監控工具，記錄詳細日誌 |

### 7.2 產品風險

| 風險 | 機率 | 影響 | 測試策略 |
|-----|------|------|---------|
| **認證系統漏洞** | 低 | 高 | 安全測試、滲透測試 |
| **資料遺失** | 低 | 高 | 資料庫完整性測試 |
| **效能瓶頸** | 中 | 中 | 負載測試、壓力測試 |
| **並發問題** | 中 | 中 | 並發測試、競態條件測試 |
| **API 錯誤處理** | 中 | 低 | 錯誤場景測試 |

---

## 8. 驗收標準

### 8.1 測試通過標準

#### 必要條件 (Must Have)
- ✅ **單元測試覆蓋率 ≥ 80%**
- ✅ **整合測試通過率 = 100%**
- ✅ **系統測試通過率 = 100%**
- ✅ **零 Critical 缺陷**
- ✅ **零 High 優先級缺陷**

#### 效能標準
- ✅ **API 回應時間 P95 < 500ms**
- ✅ **API 回應時間 P99 < 1000ms**
- ✅ **支援 100+ 併發用戶**
- ✅ **錯誤率 < 0.1%**
- ✅ **資料庫查詢時間 < 100ms**

#### 文件標準
- ✅ **測試計劃完成**
- ✅ **測試案例文件完成**
- ✅ **測試報告完成**
- ✅ **追蹤矩陣完成**
- ✅ **已知問題清單**

### 8.2 缺陷分級

| 嚴重性 | 定義 | 處理時間 |
|-------|------|---------|
| **Critical** | 系統崩潰、資料遺失、安全漏洞 | 立即修復 |
| **High** | 核心功能無法使用 | 24 小時內 |
| **Medium** | 功能部分異常但有替代方案 | 1 週內 |
| **Low** | 小問題、UI 瑕疵 | 視情況 |

### 8.3 發布檢查清單

- [ ] 所有 Critical/High 缺陷已修復
- [ ] 迴歸測試通過
- [ ] 效能測試達標
- [ ] 安全測試通過
- [ ] 文件完整
- [ ] 備份與回滾計劃就緒

---

## 9. 測試交付物

### 9.1 測試文件
1. ✅ **TEST_PLAN.md** - 本文件
2. ✅ **TEST_CASES.md** - 詳細測試案例
3. ✅ **TEST_REPORT.md** - 測試執行報告
4. ✅ **TRACEABILITY_MATRIX.md** - 追蹤矩陣

### 9.2 測試程式碼
```
tests/
├── unit/              # 單元測試
├── integration/       # 整合測試
├── system/            # 系統測試
├── performance/       # 效能測試
├── fixtures/          # 測試資料
└── conftest.py        # pytest 配置
```

### 9.3 測試報告
- HTML 覆蓋率報告 (pytest-cov)
- 測試結果摘要
- 缺陷統計
- 效能測試報告

---

## 10. 測試度量指標

### 10.1 測試覆蓋率
```python
# 目標覆蓋率
Overall Coverage: ≥ 80%
├── Backend:      ≥ 85%
│   ├── API:      ≥ 90%
│   ├── Services: ≥ 85%
│   └── Utils:    ≥ 80%
└── Frontend:     ≥ 75%
    ├── Components: ≥ 80%
    └── Store:      ≥ 90%
```

### 10.2 缺陷度量
- **缺陷密度**: < 5 defects per 1000 LOC
- **缺陷逃逸率**: < 5% (測試後才發現的缺陷)
- **平均修復時間**: < 2 天

### 10.3 測試效率
- **自動化率**: ≥ 90%
- **測試執行時間**: < 10 分鐘 (CI)
- **測試維護成本**: < 20% 開發時間

---

## 11. 附錄

### 11.1 參考文件
- [API 文件](../api/)
- [系統架構](../dev/ARCHITECTURE.md)
- [專案現況](../../PROJECT_STATUS.md)

### 11.2 測試工具文件
- [pytest 文件](https://docs.pytest.org/)
- [Vitest 文件](https://vitest.dev/)
- [Playwright 文件](https://playwright.dev/)
- [Locust 文件](https://docs.locust.io/)

### 11.3 測試團隊聯絡方式
- **測試負責人**: [Email]
- **CI/CD 支援**: [Email]
- **缺陷追蹤**: GitHub Issues

---

**文件狀態**: ✅ 已批准
**下次審查日期**: 測試執行後
**批准人**: V&V Team Lead
**版本歷史**:
- v1.0 (2025-10-24): 初版建立
